<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <style>
    body {
      padding: 100px;
      width: 1000px;
      margin: auto;
      text-align: left;
      font-weight: 300;
      font-family: 'Open Sans', sans-serif;
      color: #121212;
    }

    h1,
    h2,
    h3,
    h4 {
      font-family: 'Source Sans Pro', sans-serif;
    }
  </style>
  <title>CS 184 Mesh Editor</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>
</head>


<body>

  <h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2023</h1>
  <h1 align="middle">Project 4: Cloth Simulator</h1>
  <h2 align="middle">Billy Huang and Parth Mahawar</h2>
  <!-- Add Website URL -->
  <h2 align="middle">Website URL: <a
      href="https://cal-cs184-student.github.io/project-webpages-sp23-BillHuang0916/proj4/index.html"">Link</a></h2>
  <br>

  <div>
  <h2 align=" middle">Overview</h2>
  <p>In this project, we simulated a cloth using a model of mass points interconnected with springs and had it interact
    with a sphere and a plane. We first modeled the mass points and springs, used Verlet integration to simulate the
    cloth, added collisions with the sphere and plane objects, and finally added self-collision. Instead of using path
    tracing to render the cloth, we colored the cloth and the objects with a series of shaders using OpenGL. </p>


  <h2 align="middle">Part I: Masses and springs</h2>
  <p>
    We modeled the cloth as a row-major array of mass points interconnected by springs that represent constraints.
    Structural constraints were represented by springs to adjacent mass points, shearing constraints were represented by
    springs to diagonal neighbors of a mass point, and bending constraints were represented by springs to mass points
    two points away in each cardinal direction. Note that between any two mass points, if there is a spring between
    them, there is only one spring (no duplication).
  </p>
  <p>
    Below are an example images of our modeled cloth modeling the cloth stored in <code>scene/pinned2.json</code> with
    all constraints, no shearing constraints, and only shearing constraints.
  </p>
  <div align="middle">
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/pinned2.png" align="middle" width="90%">
          <figcaption>Wireframe of cloth generated by <code>scene/pinned2.json</code></figcaption>
        </td>
      </tr>

    </table>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/pinned2_no_shearing.png" align="middle" width="450px">
          <figcaption>No Shearing Constraints</figcaption>
        </td>
        <td>
          <img src="images/pinned2_only_shearing.png" align="middle" width="450px">
          <figcaption>Only Shearing Constraints</figcaption>
        </td>
      </tr>
    </table>
  </div>


  <h2 align="middle">Part II: Simulation via numerical integration</h2>
  <p>A low spring constant (ks) value makes the cloth looser and more flexible, which makes it resemble something almost
    like silk. On the other hand, a high spring constant makes the cloth more stiff and rigid, which would work when
    trying to emulate the properties of some stiffer real-world cloth, like denim.</p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/cloth_low_ks.png" align="middle" width="450px">
          <figcaption>A low spring constant resulting in that saggy, silky model</figcaption>
        </td>
        <td>
          <img src="images/cloth_high_ks.png" align="middle" width="450px">
          <figcaption>A high spring constant resulting in a thicker and stiffer cloth</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <p>A higher density value will result in a heavier cloth that moves slowly, while a lower density value will result in
    a lighter cloth that moves more quickly. This change in the cloth's weight also affects it's resting state, where it
    makes sense that a heavier cloth will stretch more under its own weight, given the same spring constant.</p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/cloth_low_density.png" align="middle" width="450px">
          <figcaption>A low density value results in a cloth that isn't weighed down much, instead being held up by its
            own stiffness</figcaption>
        </td>
        <td>
          <img src="images/cloth_high_density.png" align="middle" width="450px">
          <figcaption>A high density cloth weighs itself down, with the most notable difference being that the bottom
            edge isn't even horizontal</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <p>As damping represents the loss of energy in the system. it makes sense that a high damping value makes the cloth
    settle down faster, as eventually all the initial energy is lost. On the other hand, a low damping value results in
    the cloth moving for longer, as the springs take longer to lose energy.</p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/cloth_low_damping.png" align="middle" width="450px">
          <figcaption>0% damping</figcaption>
        </td>
        <td>
          <img src="images/cloth_high_damping.png" align="middle" width="450px">
          <figcaption>99% damping</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <p>Below is an image of the cloth in its final resting state.</p>
  <div align="middle">
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/cloth_final.png" align="middle" width="90%">
          <figcaption>Final resting place of cloth</figcaption>
        </td>
      </tr>
    </table>
  </div>


  <h2 align="middle">Part III: Handling collisions with other objects</h2>
  <p>
    We handled object collision by detecting if point masses of the cloth passed through the object and calculating
    where the cloth should've intersected the object. If the object was a plane, we also added a surface offset to
    ensure that the intersection point is slightly above the plane. We then calculated the correction vector from the
    point mass's last position to the intersection point and updated the point mass's new position to be the last
    position plus the correction vector times $(1 - friction)$ where $friction$ is a scaling factor for friction.
  </p>
  <p>
    Below are images of <code>scene/sphere.json</code> with varying spring constants, $ks$, showcasing a cloth falling
    onto a sphere, and an image of <code>scene/plane.json</code> with our cloth lying on a plane.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/sphere_5000.png" align="middle" width="450px">
          <figcaption>Cloth on a sphere with $ks = 5000$</figcaption>
        </td>
        <td>
          <img src="images/sphere_500.png" align="middle" width="450px">
          <figcaption>Cloth on a sphere with $ks = 500$</figcaption>
        </td>
      </tr>
      <tr align="center">
        <td>
          <img src="images/sphere_50000.png" align="middle" width="450px">
          <figcaption>Cloth on a sphere with $ks = 50000$</figcaption>
        </td>
        <td>
          <img src="images/plane.png" align="middle" width="450px">
          <figcaption>Cloth on a plane</figcaption>
        </td>
      </tr>
    </table>
  </div>
  <p>
    As we can see above, a smaller spring constant results in a weaker cloth with more folds and a larger droop. On
    the other hand, a larger spring constant results in a much stiffer cloth that spreads further away from the cloth
    and has fewer folds.
  </p>

  <h2 align="middle">Part IV: Handling self-collisions</h2>
  <p>
    We implemented self-collisions by hashing the positions of each point mass and then storing them into 3-dimensional
    box volumes that split up the simulation space. When two points in a box volume are too close we apply a repulsive
    force by adding a correction vector to one of the points.
  </p>
  <p>
    Below are three images detailing our cloth falling on itself.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/fall_initial.png" align="middle" width="450px">
          <figcaption>Initial self-collision</figcaption>
        </td>
        <td>
          <img src="images/fall_mid.png" align="middle" width="450px">
          <figcaption>The fall a bit later</figcaption>
        </td>
      </tr>
      <tr align="center">
        <td>
          <img src="images/fall_rest.png" align="middle" width="450px">
          <figcaption>The resting position</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <p>
    When we use a higher spring constant, we find that the cloth is much stiffer and generally has fewer folds
    throughout the fall. On the other hand, a cloth with a lower spring constant crumples much faster and to a farther
    extent, to the point where the cloth may fold in on itself many times. Below are two images showcasing this.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/fall_high_ks.png" align="middle" width="450px">
          <figcaption>High spring constant cloth</figcaption>
        </td>
        <td>
          <img src="images/fall_low_ks.png" align="middle" width="450px">
          <figcaption>Low spring constant cloth</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <p>
    However, density has the opposite effect. When we have a denser cloth, we find that the cloth falls flat but then
    crumples due to its own weight while a cloth with lower density is much stiffer and lighter. Below are two images
    showcasing this.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/fall_high_density.png" align="middle" width="450px">
          <figcaption>High density cloth</figcaption>
        </td>
        <td>
          <img src="images/fall_low_density.png" align="middle" width="450px">
          <figcaption>Low density cloth</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <h2 align="middle">Part V: Shaders</h2>
  <p>
    Shaders are parallel programs ran on the GPU that execute the fragment processing part of the graphics pipeline.
    Vertex shaders process vertices by applying transforms to determine their final position and are used to modify the
    geometry of a polygon to give material effects. These updated positions are then interpolated and used in fragment
    shaders to process fragments that are generated after rasterization. By using the geometric properties of the
    fragment, the fragment shaders calculate the color of the fragment, which will be used to determine the final color
    of a pixel and provide lighting effects.
  </p>

  <h3 align="middle">Blinn-Phong Shading</h3>
  <p>
    The Blinn-Phong shading model uses three components to shade polygons: the ambient component, the diffuse component,
    and the specular component. The ambient component represents any constant shading that doesn't depend on anything
    and is represented as a constant luminous intensity, while the diffuse component represents the shading independent
    of the view direction but depends on the light direction and distance and the specular component represents shading
    that is dependent on both the view and light directions. All three components are multiplied by constants determined
    by the polygon's physical properties and are summed to get the output shading.
  </p>
  <p>
    Below are images showcasing the ambient, diffuse, and specular components individually and them all three together.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/phong_ambient.png" align="middle" width="450px">
          <figcaption>Ambient component</figcaption>
        </td>
        <td>
          <img src="images/phong_diffuse.png" align="middle" width="450px">
          <figcaption>Diffuse component</figcaption>
        </td>
      </tr>
      <tr align="center">
        <td>
          <img src="images/phong_specular.png" align="middle" width="450px">
          <figcaption>Specular component</figcaption>
        </td>
        <td>
          <img src="images/phong.png" align="middle" width="450px">
          <figcaption>Full Blinn-Phong shading</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <h3 align="middle">Texture Mapping</h3>
  <p>
    Below is an image showcasing texture mapping using a <a href="images/firewatch.png">Firewatch poster</a> as the
    texture.
  </p>
  <div align="middle">
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/texture.png" align="middle" width="90%">
          <figcaption><code>scene/sphere.json</code> with a Firewatch texture</figcaption>
        </td>
      </tr>
    </table>
  </div>

  <h3 align="middle">Bump and Displacement Mapping</h3>
  <p>
    Below are images showcasing bump and displacement mapping at varying coarseness values.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/bump.png" align="middle" width="450px">
          <figcaption>Bump mapping with default coarseness</figcaption>
        </td>
        <td>
          <img src="images/displacement.png" align="middle" width="450px">
          <figcaption>Displacement mapping with default coarseness</figcaption>
        </td>
      </tr>
      <tr align="center">
        <td>
          <img src="images/bump16.png" align="middle" width="450px">
          <figcaption>Bump mapping with coarseness 16</figcaption>
        </td>
        <td>
          <img src="images/displacement16.png" align="middle" width="450px">
          <figcaption>Displacement mapping with coarseness 16</figcaption>
        </td>
      </tr>
      <tr align="center">
        <td>
          <img src="images/bump128.png" align="middle" width="450px">
          <figcaption>Bump mapping with coarseness 128</figcaption>
        </td>
        <td>
          <img src="images/displacement128.png" align="middle" width="450px">
          <figcaption>Displacement mapping with coarseness 128</figcaption>
        </td>
      </tr>
    </table>
  </div>
  <p>
    As we can see above, bump mapping colors the cloth and sphere to emulate the height differences in the texture
    while displacement mapping takes this a step further by also adjusting the geometry of both the cloth and sphere to
    match the height differences in the brick texture.
  </p>
  <p>
    Furthermore, we can see that a higher coarseness value results in a smoother sphere while a lower value results
    in a sphere with sharper edges (open image for higher resolution). However, this effect is more prominent in
    displacement
    mapping than bump mapping because displacement mapping adjust the positions of each vertex, so its changes in a
    coarser sphere are more drastic.
  </p>

  <h3 align="middle">Environment-mapped Reflections</h3>
  <p>
    Below are images showcasing mirror shading on the cloth and sphere.
  </p>
  <div>
    <table style="width:100%">
      <tr align="center">
        <td>
          <img src="images/mirror_cloth.png" align="middle" width="450px">
          <figcaption>Cloth and sphere separated</figcaption>
        </td>
        <td>
          <img src="images/mirror_sphere.png" align="middle" width="450px">
          <figcaption>Cloth and sphere after simulation</figcaption>
        </td>
      </tr>
    </table>
  </div>

  </div>
</body>

</html>